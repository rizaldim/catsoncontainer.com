<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A bit about Prometheus&#39; metrics">

  <title>Prometheus&#39; Metrics</title>

  <link rel="stylesheet" href="/reset.css">
  <link rel="stylesheet" href="/style.css">

  <link rel="alternate" href="feed/feed.xml" type="application/atom+xml" title="Cats on container">
</head>

<body>

<header>
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/blog/">Archive</a></li>
      <li><a href="/about/">About</a></li>
      <li><a href="/feed/feed.xml">Feed</a></li>
    </ul>
  </nav>
</header>

<main>
      
<h1 id="prometheus-metrics">Prometheus&#39; Metrics</h1>

<ul>
  <li><time datetime="2024-06-24">24 June 2024</time></li>
  <li><a href="/tags/prometheus/">prometheus</a></li>
</ul>

<p>
Continuing from the <a href="/posts/prometheus-1">previous post</a>, let's check on the
metrics provided by prometheus.
</p>

<h2>The metrics</h2>

<p>
If you go back to Prometheus UI on the targets page, there is one target
currently watched by prometheus. The endpoint for that target is
<a href="http://localhost:9090/metrics">http://localhost:9090/metrics</a>. So by default
when you run prometheus, it will also serve its own metrics at port 9090.
</p>

<p>Click the link on the targets page, you will see the metrics.</p>

<picture>
  <source type="image/avif" srcset="/blog/prometheus-2/IY60_P70E6-2294.avif 2294w">
  <source type="image/webp" srcset="/blog/prometheus-2/IY60_P70E6-2294.webp 2294w">
  <img loading="lazy" decoding="async" src="/blog/prometheus-2/IY60_P70E6-2294.png" alt="Prometheus targets" width="2294" height="1022">
</picture>

<picture>
  <source type="image/avif" srcset="/blog/prometheus-2/R4atf8psl1-2080.avif 2080w">
  <source type="image/webp" srcset="/blog/prometheus-2/R4atf8psl1-2080.webp 2080w">
  <img loading="lazy" decoding="async" src="/blog/prometheus-2/R4atf8psl1-2080.png" alt="Prometheus metrics" width="2080" height="592">
</picture>

<p>
Each line in that page is a metric, except for line started with a #, which are
the documentation for the metric that comes after those lines. For example the
very first metric called <strong>go_gc_cycles_automatic_gc_cycles_total</strong>. In the page
it's shown like this.
</p>

<pre class="language-promql" tabindex="0">
<code class="language-promql">
# HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime.
# TYPE go_gc_cycles_automatic_gc_cycles_total counter
go_gc_cycles_automatic_gc_cycles_total 16
</code>
</pre>

<p>
The first line, which is started with <code># HELP</code>, is the description of the metric.
The second line, which is started with <code># TYPE</code>, is the type of the metric,
<strong>counter</strong>. It is one of metric types in prometheus. The third line is the
metric and its value. Notice that it has no unit, only the value.
</p>

<h2>The labels</h2>

<p>
While reading the metrics you might notice that some metrics have curly braces
with some kind of key-value pair in it. Like,
</p>

<pre class="language-promql" tabindex="0">
<code class="language-promql">
go_gc_heap_allocs_by_size_bytes_bucket{le="8.999999999999998"} 19461
go_gc_heap_allocs_by_size_bytes_bucket{le="24.999999999999996"} 130267
go_gc_heap_allocs_by_size_bytes_bucket{le="64.99999999999999"} 304207
</code>
</pre>

<p>or,</p>

<pre class="language-promql" tabindex="0">
<code class="language-promql">
prometheus_engine_query_duration_seconds{slice="inner_eval",quantile="0.5"} 0.000583584
prometheus_engine_query_duration_seconds{slice="inner_eval",quantile="0.9"} 0.000583584
prometheus_engine_query_duration_seconds{slice="inner_eval",quantile="0.99"} 0.000583584
</code>
</pre>

<p>
Those are labels. The keys in those pairs are the label name and the values are
the label values. For now, for the prometheus metrics that we don't really
understand, the labels might not make a lot of sense. Later on when we use it
with <a href="https://prometheus.io/docs/guides/node-exporter/">node exporter</a>
it will make a lot more sense.
</p>

<h2>Metrics scraping</h2>

<p>
So basically for the one target that the prometheus is monitoring currently,
prometheus will get the metrics from the endpoint, localhost:9090/metrics, and
store it. How often prometheus scrapes the metrics is determined by the
configuration used. So if we go back to the <strong>prometheus.yaml</strong> file,
</p>

<pre class="language-yaml" tabindex="0">
<code class="language-yaml">
global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
</code>
</pre>

<p>, we can see that prometheus scrapes the metric every 15 seconds.</p>

<h2>The graph</h2>

<p>
One last thing before we finished this post, prometheus helps us to graph our
metrics by providing a graph page. It's on the top menu of the prometheus UI.
</p>

<picture>
  <source type="image/avif" srcset="/blog/prometheus-2/bkkpto5Qmh-1936.avif 1936w">
  <source type="image/webp" srcset="/blog/prometheus-2/bkkpto5Qmh-1936.webp 1936w">
  <img loading="lazy" decoding="async" src="/blog/prometheus-2/bkkpto5Qmh-1936.png" alt="Prometheus UI top menu" width="1936" height="116">
</picture>

<p>
Click <strong>Graph</strong> and it will open the graph page. On that page, there is a field
to input the expression for metrics. Let's type in <strong>go_gc_cycles_total_gc_cycles_total</strong>. It's one of metrics with type counter. So a counter metrics is a metrics
with value that always go up. After you type in the metrics name, click the
<strong>Execute</strong> button. It will show you its current value.
</p>

<picture>
  <source type="image/avif" srcset="/blog/prometheus-2/I-VfR_BIH--2862.avif 2862w">
  <source type="image/webp" srcset="/blog/prometheus-2/I-VfR_BIH--2862.webp 2862w">
  <img loading="lazy" decoding="async" src="/blog/prometheus-2/I-VfR_BIH--2862.png" alt="Prometheus metrics table" width="2862" height="706">
</picture>

<p>
Below the field to type in the expression, there is a <strong>Graph</strong> tab just at the right
side of <strong>Table</strong>. Click on that and it will show you the graph of the metrics.
</p>

<picture>
  <source type="image/avif" srcset="/blog/prometheus-2/iOQpnmwjJW-2840.avif 2840w">
  <source type="image/webp" srcset="/blog/prometheus-2/iOQpnmwjJW-2840.webp 2840w">
  <img loading="lazy" decoding="async" src="/blog/prometheus-2/iOQpnmwjJW-2840.png" alt="Prometheus metrics graph" width="2840" height="1306">
</picture>

<h2>Conclusion</h2>

<p>
In this post, we discuss a little bit about prometheus' metrics and labels. Also
we discuss about how to see the graph of a metrics. In the next post, we will use
prometheus' node exporter to monitor our local machine's CPU and memory usage.
</p>


</main>

</body>

</html>
